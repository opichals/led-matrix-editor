<!DOCTYPE html>
<html>
<head lang="en">
    <title>LED Matrix Editor Pro</title>

    <meta charset="UTF-8">
    <meta name="keywords" content="LED matrix, 8x8, matrix editor, matrix animation">
    <meta name="description" content="Online matrix editor pro: create images for LED matrix">
    <meta name="author" content="worldmaker18349276"/>

    <link rel="icon" type="image/png" href="img/icon.png"/>
    <style>
        @media only screen and (min-height: 900px) {
            #frames {
                height: 400px;
            }
        }
    </style>

    <link rel="stylesheet" href="https://unpkg.com/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css">

    <script src="https://unpkg.com/jquery@3.2.1/dist/jquery.min.js"></script>
    <script src="https://unpkg.com/jquery-ui@1.12.1/ui/widget.js"></script>
    <script src="https://unpkg.com/jquery-ui@1.12.1/ui/data.js"></script>
    <script src="https://unpkg.com/jquery-ui@1.12.1/ui/scroll-parent.js"></script>
    <script src="https://unpkg.com/jquery-ui@1.12.1/ui/widgets/mouse.js"></script>
    <script src="https://unpkg.com/jquery-ui@1.12.1/ui/widgets/sortable.js"></script>
    <script src="https://unpkg.com/js-cookie@2.1.4/src/js.cookie.js"></script>

    <script src="https://unpkg.com/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

    <style>
body {
    background: #eee;
    user-select: none;
    -webkit-user-select: none;
}

#cols-list,
#rows-list,
#leds-matrix {
    font-family: "Bitstream Vera Sans Mono", Monaco, "Courier New", Courier, monospace;
    border-spacing: 5px;
    border-collapse: separate;
}

#leds-matrix .item,
#cols-list .item,
#rows-list .item {
    width: 25px;
    min-width: 25px;
    max-width: 25px;

    height: 25px;
    min-height: 25px;
    max-height: 25px;

    cursor: pointer;
    font-size: 17px;
}

#leds-matrix .item {
    border-radius: 50%;
    box-shadow: inset 0 0 1px #666666;
    background: #808080 radial-gradient(ellipse at 42% 42%, #999999 0%, #808080 50%);
}

#leds-matrix {
    background-color: #333;
    box-shadow: 1px 1px 10px #333;
}

body.red-leds #matrix-toggle:hover,
body.red-leds #cols-list .item:hover,
body.red-leds #rows-list .item:hover,
body.red-leds #cols-list .item.hover,
body.red-leds #rows-list .item.hover {
    color: #ff3333;
    font-weight: bold;
}

#red-leds-case,
body.red-leds #frames .item.active,
body.red-leds #leds-matrix .item.active {
    background: #ff0000 radial-gradient(ellipse at 42% 42%, #ffffff 0%, #ff3300 25%, #ff0000 50%);
}

body.yellow-leds #matrix-toggle:hover,
body.yellow-leds #cols-list .item:hover,
body.yellow-leds #rows-list .item:hover,
body.yellow-leds #cols-list .item.hover,
body.yellow-leds #rows-list .item.hover {
    color: #ffcc33;
    font-weight: bold;
}

#yellow-leds-case,
body.yellow-leds #frames .item.active,
body.yellow-leds #leds-matrix .item.active {
    background: #ffcc00 radial-gradient(ellipse at 42% 42%, #ffffff 0%, #ffcc00 25%, #ffcc00 50%);
}

body.green-leds #matrix-toggle:hover,
body.green-leds #cols-list .item:hover,
body.green-leds #rows-list .item:hover,
body.green-leds #cols-list .item.hover,
body.green-leds #rows-list .item.hover {
    color: #33ff33;
    font-weight: bold;
}

#green-leds-case,
body.green-leds #frames .item.active,
body.green-leds #leds-matrix .item.active {
    background: #00ff00 radial-gradient(ellipse at 42% 42%, #ffffff 0%, #00ff33 25%, #00ff00 50%);
}

body.blue-leds #matrix-toggle:hover,
body.blue-leds #cols-list .item:hover,
body.blue-leds #rows-list .item:hover,
body.blue-leds #cols-list .item.hover,
body.blue-leds #rows-list .item.hover {
    color: #0033ff;
    font-weight: bold;
}

#blue-leds-case,
body.blue-leds #frames .item.active,
body.blue-leds #leds-matrix .item.active {
    background: #0000ff radial-gradient(ellipse at 42% 42%, #ffffff 0%, #0033ff 25%, #0000ff 50%);
}

body.white-leds #matrix-toggle:hover,
body.white-leds #cols-list .item:hover,
body.white-leds #rows-list .item:hover,
body.white-leds #cols-list .item.hover,
body.white-leds #rows-list .item.hover {
    color: #ffffff;
    font-weight: bold;
}

#white-leds-case,
body.white-leds #frames .item.active,
body.white-leds #leds-matrix .item.active {
    background: #ffffff radial-gradient(ellipse at 42% 42%, #ffffff 0%, #eeeeee 25%, #ffffff 50%);
}

#player {
    display: inline-block;
    padding: 10px;
}

#play-delay-input {
    height: 25px;
    width: 65px;
    padding: 5px;
    border: none;
}

#play-button {
    width: 35px;
    padding: 0px;
}

#hex-input {
    font-family: "Bitstream Vera Sans Mono", Monaco, "Courier New", Courier, monospace;
    text-align: center;
    width: 150px;
    height: 30px;
    padding: 0px;
}

#edit-buttons-container {
    padding: 10px;
}

#shift-buttons-container {
    display: inline-block;
    position: relative;
    box-sizing: content-box;
    width: 130px;
    height: 130px;
}

#import-button,
#insert-button,
#update-button,
#delete-button {
    width: 60px;
    height: 30px;
    margin: 0 5px;
    padding: 0px;
}

#rotate-button,
#shift-up-button,
#shift-right-button,
#shift-down-button,
#shift-left-button,
#cyclic-shift-right-button,
#cyclic-shift-down-button,
#vertical-flip-button,
#horizontal-flip-button {
    position: absolute;
    height: 30px;
    width: 30px;
    font-size: 15px;
    box-sizing: border-box;
    padding: 0px;
}

.leds-case {
    display: inline-block;
    width: 25px;
    height: 25px;
    cursor: pointer;
    border-radius: 50%;
    box-shadow: inset 0 0 1px #333333;
    background: #cccccc radial-gradient(circle at center, lightgray 0%, darkgray 100%);
}

#leds-matrix .item:hover,
.leds-case:hover {
    box-shadow: 0 0 1px #cccccc;
}

#frames {
    padding: 5px;
    height: 200px;
    overflow-y: scroll;
    text-align: left;
    border: solid #666666 1px;
    background: #ccc linear-gradient(#ccc, #aaa)
}

#frames .frame {
    margin: 2px;
    display: inline-block;
    background-color: #333;
    border-spacing: 2px;
    border-collapse: separate;
    border: solid #ccc 3px;
    table-layout: fixed;
}

#frames .frame .item {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    box-shadow: inset 0 0 1px #333333;
    background: #808080;
}

#frames .frame.selected {
    border-color: #3399ff;
}

#output {
    font-family: "Bitstream Vera Sans Mono", Monaco, "Courier New", Courier, monospace;
    resize: none;
    padding: 5px;
    height: 280px;
    overflow-y: scroll;
}
    </style>

    <script>
$(function () {
    var $body = $('body');
    var $frames = $('#frames');
    var $hexInput = $('#hex-input');
    var $importButton = $('#import-button');
    var $insertButton = $('#insert-button');
    var $deleteButton = $('#delete-button');
    var $updateButton = $('#update-button');

    var $leds, $cols, $rows;

    var generator = {
        tableCols: function () {
            var out = ['<table id="cols-list"><tr>'];
            for (var i = 1; i < 9; i++) {
                out.push('<td class="item" data-col="' + i + '">' + i + '</td>');
            }
            out.push('</tr></table>');
            return out.join('');
        },
        tableRows: function () {
            var out = ['<table id="rows-list">'];
            for (var i = 1; i < 9; i++) {
                out.push('<tr><td class="item" data-row="' + i + '">' + i + '</td></tr>');
            }
            out.push('</table>');
            return out.join('');
        },
        tableLeds: function () {
            var out = ['<table id="leds-matrix" tabindex="1">'];
            for (var i = 1; i < 9; i++) {
                out.push('<tr>');
                for (var j = 1; j < 9; j++) {
                    out.push('<td class="item" data-row="' + i + '" data-col="' + j + '"></td>');
                }
                out.push('</tr>');
            }
            out.push('</table>');
            return out.join('');
        }
    };

    var converter = {
        patternToFrame: function (pattern) {
            var out = ['<table class="frame" data-hex="' + pattern + '">'];
            for (var i = 1; i < 9; i++) {
                var byte = pattern.substr(-2 * i, 2);
                byte = parseInt(byte, 16);

                out.push('<tr>');
                for (var j = 0; j < 8; j++) {
                    if ((byte & 1 << j)) {
                        out.push('<td class="item active"></td>');
                    } else {
                        out.push('<td class="item"></td>');
                    }
                }
                out.push('</tr>');
            }
            out.push('</table>');
            return out.join('');
        },
        patternsToCodeUint64Array: function (patterns) {
            var out = ['const uint64_t IMAGES[] = {\n'];

            for (var i = 0; i < patterns.length; i++) {
                out.push('  0x');
                out.push(patterns[i]);
                out.push(',\n');
            }
            out.pop();
            out.push('\n};\n');
            out.push('const int IMAGES_LEN = sizeof(IMAGES)/8;\n');

            return out.join('');
        },
        patternsToCodeBytesArray: function (patterns) {
            var out = ['const byte IMAGES[][8] = {\n'];

            for (var i = 0; i < patterns.length; i++) {
                out.push('{\n');
                for (var j = 7; j >= 0; j--) {
                    var byte = patterns[i].substr(2 * j, 2);
                    byte = parseInt(byte, 16).toString(2);
                    byte = ('00000000' + byte).substr(-8);
                    byte = byte.split('').reverse().join('');
                    out.push('  B');
                    out.push(byte);
                    out.push(',\n');
                }
                out.pop();
                out.push('\n}');
                out.push(',');
            }
            out.pop();
            out.push('};\n');
            out.push('const int IMAGES_LEN = sizeof(IMAGES)/8;\n');
            return out.join('');
        },
        fixPattern: function (pattern) {
            pattern = pattern.replace(/[^0-9a-fA-F]/g, '0');
            return ('0000000000000000' + pattern).substr(-16);
        },
        fixPatterns: function (patterns) {
            for (var i = 0; i < patterns.length; i++) {
                patterns[i] = converter.fixPattern(patterns[i]);
            }
            return patterns;
        }
    };

    function makeFrameElement(pattern) {
        pattern = converter.fixPattern(pattern);
        return $(converter.patternToFrame(pattern)).click(onFrameClick);
    }

    function ledsToHex() {
        var out = [];
        for (var i = 1; i < 9; i++) {
            var byte = [];
            for (var j = 1; j < 9; j++) {
                var active = $leds.find('.item[data-row=' + i + '][data-col=' + j + '] ').hasClass('active');
                byte.push(active ? '1' : '0');
            }
            byte.reverse();
            byte = parseInt(byte.join(''), 2).toString(16);
            byte = ('0' + byte).substr(-2);
            out.push(byte);
        }
        out.reverse();
        $hexInput.val(out.join(''));
    }

    function hexInputToLeds() {
        var val = getInputHexValue();
        for (var i = 1; i < 9; i++) {
            var byte = val.substr(-2 * i, 2);

            byte = parseInt(byte, 16);
            for (var j = 1; j < 9; j++) {
                var active = !!(byte & 1 << (j - 1));
                $leds.find('.item[data-row=' + i + '][data-col=' + j + '] ').toggleClass('active', active);
            }
        }
    }

    var savedHashState;

    function printArduinoCode(patterns) {
        if (patterns.length) {
            var code;
            if ($('#images-as-byte-arrays').prop("checked")) {
                code = converter.patternsToCodeBytesArray(patterns);
            } else {
                code = converter.patternsToCodeUint64Array(patterns);
            }
            $('#output').val(code);
        }
    }

    function framesToPatterns() {
        var out = [];
        $frames.find('.frame').each(function () {
            out.push($(this).attr('data-hex'));
        });
        return out;
    }

    function saveState() {
        var patterns = framesToPatterns();
        printArduinoCode(patterns);
        window.location.hash = savedHashState = patterns.join('|');
    }

    function loadState() {
        savedHashState = window.location.hash.slice(1);
        $frames.empty();
        var frame;
        var patterns = savedHashState.split('|');
        patterns = converter.fixPatterns(patterns);

        for (var i = 0; i < patterns.length; i++) {
            frame = makeFrameElement(patterns[i]);
            $frames.append(frame);
        }
        frame.addClass('selected');
        $hexInput.val(frame.attr('data-hex'));
        printArduinoCode(patterns);
        hexInputToLeds();
    }

    function getInputHexValue() {
        return converter.fixPattern($hexInput.val());
    }

    function onFrameClick() {
        $hexInput.val($(this).attr('data-hex'));
        focusToFrame($(this));
        hexInputToLeds();
    }

    function focusToFrame($focusToFrame) {
        $frames.find('.frame.selected').removeClass('selected');

        if ($focusToFrame.length) {
            $focusToFrame.addClass('selected');
            $deleteButton.removeAttr('disabled');
            $updateButton.removeAttr('disabled');
        } else {
            $deleteButton.attr('disabled', 'disabled');
            $updateButton.attr('disabled', 'disabled');
        }
        $leds.focus();
    }

    $('#cols-container').append($(generator.tableCols()));
    $('#rows-container').append($(generator.tableRows()));
    $('#leds-container').append($(generator.tableLeds()));

    $cols = $('#cols-list');
    $rows = $('#rows-list');
    $leds = $('#leds-matrix');

    var edit_mode = 0;

    $leds.find('.item').mousedown(function (e) {
        cachePattern();
        if (e.shiftKey) {
            edit_mode = 3;
        } else if ($(this).is(".active")) {
            edit_mode = 2;
        } else {
            edit_mode = 1;
        }
        $(this).toggleClass('active');
        ledsToHex();
    });

    $("#leds-container").mouseleave(function () {
        edit_mode = 0;
    }).mouseup(function () {
        edit_mode = 0;
    });

    $leds.find('.item').mouseenter(function () {
        if (edit_mode == 1) {
            $(this).toggleClass('active', true);
        } else if (edit_mode == 2) {
            $(this).toggleClass('active', false);
        } else if (edit_mode == 3) {
            $(this).toggleClass('active');
        } else {
            return;
        }
        ledsToHex();
    });

    var patternTool = {
        rotate: function (pattern, direction) {
            var byte_table = [];
            for (var i = 7; i >= 0; i--) {
                byte_table.push(parseInt(pattern.substr(2 * i, 2), 16));
            }
            var rot = [];
            for (var i = 0; i < 8; i++) {
                var byte = 0;
                for (var j = 0; j < 8; j++) {
                    if (direction) {
                        if (byte_table[7-j] >> i & 1) {
                            byte |= 1 << j;
                        }
                    } else {
                        if (byte_table[j] >> (7-i) & 1) {
                            byte |= 1 << j;
                        }
                    }
                }
                rot.push(('0' + byte.toString(16)).substr(-2));
            }
            return rot.reverse().join('');
        },
        flipH: function (pattern) {
            var flip = [];
            for (var i = 0; i < 8; i++) {
                var byte = pattern.substr(2 * i, 2);
                byte = parseInt(byte, 16).toString(2);
                byte = ('00000000' + byte).substr(-8);
                byte = byte.split('').reverse().join('');
                byte = parseInt(byte, 2).toString(16);
                byte = ('0' + byte).substr(-2);
                flip.push(byte);
            }
            return flip.join('');
        },
        flipV: function (pattern) {
            return pattern.match(/.{2}/g).reverse().join('');
        },
        up: function (pattern, cyclic) {
            return (cyclic ? pattern.substr(14, 2) : '00') + pattern.substr(0, 14);
        },
        down: function (pattern, cyclic) {
            return pattern.substr(2, 14) + (cyclic ? pattern.substr(0, 2) : '00');
        },
        right: function (pattern, cyclic) {
            var out = [];
            for (var i = 0; i < 8; i++) {
                var byte = pattern.substr(i * 2, 2);
                byte = parseInt(byte, 16);
                if (cyclic) {
                    byte = (byte << 1) | (byte >> 7);
                } else {
                    byte <<= 1;
                }
                byte = byte.toString(16);
                byte = ('0' + byte).substr(-2);
                out.push(byte);
            }
            return out.join('');
        },
        left: function (pattern, cyclic) {
            var out = [];
            for (var i = 0; i < 8; i++) {
                var byte = pattern.substr(i * 2, 2);
                byte = parseInt(byte, 16);
                if (cyclic) {
                    byte = (byte >> 1) | (byte << 7);
                } else {
                    byte >>= 1;
                }
                byte = byte.toString(16);
                byte = ('0' + byte).substr(-2);
                out.push(byte);
            }
            return out.join('');
        },
        not: function (pattern) {
            var out = [];
            for (var i = 0; i < 8; i++) {
                var byte = pattern.substr(i * 2, 2);
                byte = ~parseInt(byte, 16);
                byte = byte.toString(16);
                byte = ('0' + byte).substr(-2);
                out.push(byte);
            }
            return out.join('');
        },
        or: function (pattern1, pattern2) {
            var out = [];
            for (var i = 0; i < 8; i++) {
                var byte1 = pattern1.substr(i * 2, 2);
                var byte2 = pattern2.substr(i * 2, 2);
                var byte = parseInt(byte1, 16) | parseInt(byte2, 16);
                byte = byte.toString(16);
                byte = ('0' + byte).substr(-2);
                out.push(byte);
            }
            return out.join('');
        },
        xor: function (pattern1, pattern2) {
            var out = [];
            for (var i = 0; i < 8; i++) {
                var byte1 = pattern1.substr(i * 2, 2);
                var byte2 = pattern2.substr(i * 2, 2);
                var byte = parseInt(byte1, 16) ^ parseInt(byte2, 16);
                byte = byte.toString(16);
                byte = ('0' + byte).substr(-2);
                out.push(byte);
            }
            return out.join('');
        },
        and: function (pattern1, pattern2) {
            var out = [];
            for (var i = 0; i < 8; i++) {
                var byte1 = pattern1.substr(i * 2, 2);
                var byte2 = pattern2.substr(i * 2, 2);
                var byte = parseInt(byte1, 16) & parseInt(byte2, 16);
                byte = byte.toString(16);
                byte = ('0' + byte).substr(-2);
                out.push(byte);
            }
            return out.join('');
        }
    };

    $('#rotate-button').click(function () {
        cachePattern();
        $hexInput.val(patternTool.rotate(getInputHexValue(), true));
        hexInputToLeds();
    });

    $('#shift-up-button').click(function () {
        cachePattern();
        $hexInput.val(patternTool.up(getInputHexValue()));
        hexInputToLeds();
    });

    $('#shift-down-button').click(function () {
        cachePattern();
        $hexInput.val(patternTool.down(getInputHexValue()));
        hexInputToLeds();
    });

    $('#shift-right-button').click(function () {
        cachePattern();
        $hexInput.val(patternTool.right(getInputHexValue()));
        hexInputToLeds();
    });

    $('#shift-left-button').click(function () {
        cachePattern();
        $hexInput.val(patternTool.left(getInputHexValue()));
        hexInputToLeds();
    });

    var patternClipboard = 0;
    var patternHistory = [];
    function cachePattern() {
        patternHistory.push($hexInput.val());
        while (patternHistory.length > 50) {
            patternHistory.shift();
        }
    }

    $leds.keydown(function (e) {
        if (e.keyCode == 39) {
            cachePattern();
            if (e.ctrlKey) {
                $hexInput.val(patternTool.rotate(getInputHexValue(), true));
                hexInputToLeds();
            } else {
                $hexInput.val(patternTool.right(getInputHexValue(), e.shiftKey));
                hexInputToLeds();
            }
        } else if (e.keyCode == 37) {
            cachePattern();
            if (e.ctrlKey) {
                $hexInput.val(patternTool.rotate(getInputHexValue(), false));
                hexInputToLeds();
            } else {
                $hexInput.val(patternTool.left(getInputHexValue(), e.shiftKey));
                hexInputToLeds();
            }
        } else if (e.keyCode == 38) {
            cachePattern();
            if (e.ctrlKey) {
                $hexInput.val(patternTool.flipV(getInputHexValue()));
                hexInputToLeds();
            } else {
                $hexInput.val(patternTool.up(getInputHexValue(), e.shiftKey));
                hexInputToLeds();
            }
        } else if (e.keyCode == 40) {
            cachePattern();
            if (e.ctrlKey) {
                $hexInput.val(patternTool.flipV(getInputHexValue()));
                hexInputToLeds();
            } else {
                $hexInput.val(patternTool.down(getInputHexValue(), e.shiftKey));
                hexInputToLeds();
            }
        } else if (e.keyCode == 67 && e.ctrlKey) {
            patternClipboard = getInputHexValue();
        } else if (e.keyCode == 86 && e.ctrlKey) {
            cachePattern();
            var val;
            if (e.shiftKey) {
                val = patternTool.xor(getInputHexValue(), patternClipboard);
            } else {
                val = patternTool.or(getInputHexValue(), patternClipboard);
            }
            $hexInput.val(val);
            hexInputToLeds();
        } else if (e.keyCode == 90 && e.ctrlKey) {
            $hexInput.val(patternHistory.pop());
            hexInputToLeds();
        } else if (e.keyCode == 33) {
            if (e.altKey) {
                var $thisFrame = $frames.find('.frame.selected').first();
                var $prevFrame = $thisFrame.prev('.frame');
                if ($prevFrame.length) {
                    $prevFrame.before($thisFrame);
                    saveState();
                }
            } else {
                var $prevFrame = $frames.find('.frame.selected').first().prev('.frame');
                if ($prevFrame.length) {
                    $hexInput.val($prevFrame.attr('data-hex'));
                    focusToFrame($prevFrame);
                    hexInputToLeds();
                }
            }
        } else if (e.keyCode == 34) {
            if (e.altKey) {
                var $thisFrame = $frames.find('.frame.selected').first();
                var $nextFrame = $thisFrame.next('.frame');
                if ($nextFrame.length) {
                    $nextFrame.after($thisFrame);
                    saveState();
                }
            } else {
                var $nextFrame = $frames.find('.frame.selected').first().next('.frame');
                if ($nextFrame.length) {
                    $hexInput.val($nextFrame.attr('data-hex'));
                    focusToFrame($nextFrame);
                    hexInputToLeds();
                }
            }
        } else if (e.keyCode == 32) {
            $("#play-button").click();
        } else if (e.keyCode == 13) {
            if (e.ctrlKey) {
                $updateButton.click();
            } else {
                $insertButton.click();
            }
        } else if (e.keyCode == 46) {
            $deleteButton.click();
        } else {
            return;
        }
        e.preventDefault();
    });

    $cols.find('.item').mousedown(function (e) {
        cachePattern();
        var col = $(this).attr('data-col');
        if (e.shiftKey) {
            $leds.find('.item[data-col=' + col + ']').toggleClass('active');
        } else {
            $leds.find('.item[data-col=' + col + ']').toggleClass('active',
                $leds.find('.item[data-col=' + col + '].active').length != 8);
        }
        ledsToHex();
    });

    $rows.find('.item').mousedown(function (e) {
        cachePattern();
        var row = $(this).attr('data-row');
        if (e.shiftKey) {
            $leds.find('.item[data-row=' + row + ']').toggleClass('active');
        } else {
            $leds.find('.item[data-row=' + row + ']').toggleClass('active',
                $leds.find('.item[data-row=' + row + '].active').length != 8);
        }
        ledsToHex();
    });

    $hexInput.keyup(function () {
        cachePattern();
        hexInputToLeds();
    });

    $deleteButton.click(function () {
        var $selectedFrame = $frames.find('.frame.selected').first();
        var $nextFrame = $selectedFrame.next('.frame').first();

        if (!$nextFrame.length) {
            $nextFrame = $selectedFrame.prev('.frame').first();
        }

        $selectedFrame.remove();

        if ($nextFrame.length) {
            $hexInput.val($nextFrame.attr('data-hex'));
        }

        focusToFrame($nextFrame);
        saveState();

        hexInputToLeds();
    });

    $insertButton.click(function () {
        var $newFrame = makeFrameElement(getInputHexValue());
        var $selectedFrame = $frames.find('.frame.selected').first();

        if ($selectedFrame.length) {
            $selectedFrame.after($newFrame);
        } else {
            $frames.append($newFrame);
        }

        focusToFrame($newFrame);
        saveState();
    });

    $updateButton.click(function () {
        var $newFrame = makeFrameElement(getInputHexValue());
        var $selectedFrame = $frames.find('.frame.selected').first();

        if ($selectedFrame.length) {
            $selectedFrame.replaceWith($newFrame);
        } else {
            $frames.append($newFrame);
        }

        focusToFrame($newFrame);
        saveState();
    });

    $importButton.click(function () {
        var url = prompt("input hashtag:");
        if (url) {
            url = /[^#]*$/g.exec(url)[0];
            var regex = /[0-9a-fA-F]+/g;
            var match;
            var $currentFrame = $frames.find('.frame.selected').first();
            do {
                match = regex.exec(url);
                if ($currentFrame.length) {
                    $currentFrame = makeFrameElement(match[0]).insertAfter($currentFrame);
                } else {
                    $currentFrame = makeFrameElement(match[0]).appendTo($frames);
                }
            } while (match);

            focusToFrame($currentFrame);
            saveState();
        }
    });

    $('#images-as-byte-arrays').change(function () {
        var patterns = framesToPatterns();
        printArduinoCode(patterns);
    });


    $('#matrix-toggle').hover(function () {
        $cols.find('.item').addClass('hover');
        $rows.find('.item').addClass('hover');
    }, function () {
        $cols.find('.item').removeClass('hover');
        $rows.find('.item').removeClass('hover');
    });

    $('#matrix-toggle').mousedown(function (e) {
        cachePattern();
        var col = $(this).attr('data-col');
        if (e.shiftKey) {
            $leds.find('.item').toggleClass('active');
        } else {
            $leds.find('.item').toggleClass('active', $leds.find('.item.active').length != 64);
        }
        ledsToHex();
    });

    $('.leds-case').click(function () {
        var themeName = $(this).attr('data-leds-theme');
        setLedsTheme(themeName);
        Cookies.set('leds-theme', themeName, {path: ''});
    });

    function setLedsTheme(themeName) {
        $body.removeClass('red-leds yellow-leds green-leds blue-leds white-leds').addClass(themeName);
    }

    var playInterval;

    $('#play-button').click(function () {
        if (playInterval) {
            $('#play-button-stop').hide();
            $('#play-button-play').show();
            clearInterval(playInterval);
            playInterval = null;
        } else {
            $('#play-button-stop').show();
            $('#play-button-play').hide();

            playInterval = setInterval(function () {
                var $selectedFrame = $frames.find('.frame.selected').first();
                var $nextFrame = $selectedFrame.next('.frame').first();

                if (!$nextFrame.length) {
                    $nextFrame = $frames.find('.frame').first();
                }

                if ($nextFrame.length) {
                    $hexInput.val($nextFrame.attr('data-hex'));
                }

                focusToFrame($nextFrame);

                hexInputToLeds();
            }, $('#play-delay-input').val());
        }
    });


    $(window).on('hashchange', function () {
        if (window.location.hash.slice(1) != savedHashState) {
            loadState();
        }
    });

    $frames.sortable({
        stop: function (event, ui) {
            saveState();
        }
    });

    loadState();

    var ledsTheme = Cookies.get('leds-theme');

    if (ledsTheme) {
        setLedsTheme(ledsTheme);
    }

    $leds.focus();
});
    </script>

</head>

<body class="red-leds plain-theme">

<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">LED Matrix Editor Pro</a>
        </div>

        <ul class="nav navbar-nav">
            <li><a href="#overview">Overview</a></li>
            <li><a href="#samples">Code samples</a></li>
            <li><a href="http://xantorohara.github.io/led-matrix-editor/">Original version</a></li>
        </ul>

        <p class="navbar-text pull-right small">
            <span class="glyphicon glyphicon-hand-up"></span>
            Use CTRL+D to save current state as a bookmark
        </p>

        <div class="navbar-text pull-right" style="margin-top: 10px; margin-bottom: 5px;">
            <div id="red-leds-case" class="leds-case" data-leds-theme="red-leds"></div>
            <div id="yellow-leds-case" class="leds-case" data-leds-theme="yellow-leds"></div>
            <div id="green-leds-case" class="leds-case" data-leds-theme="green-leds"></div>
            <div id="blue-leds-case" class="leds-case" data-leds-theme="blue-leds"></div>
            <div id="white-leds-case" class="leds-case" data-leds-theme="white-leds"></div>
        </div>
        <p class="navbar-text pull-right small">
            Select LEDs color <span class="glyphicon glyphicon-hand-right"></span>
        </p>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-xs-6 col-md-3 debug">
            <h3>Library</h3>
            <ul id="sets">
                <li>Set №1:
                    <a href="#7e1818181c181800|7e060c3060663c00|3c66603860663c00|30307e3234383000|3c6660603e067e00|3c66663e06663c00|1818183030667e00|3c66663c66663c00|3c66607c66663c00|3c66666e76663c00">
                        Digits
                    </a> /
                    <a href="#6666667e66663c00|3e66663e66663e00|3c66060606663c00|3e66666666663e00|7e06063e06067e00|0606063e06067e00|3c66760606663c00|6666667e66666600|3c18181818183c00|1c36363030307800|66361e0e1e366600|7e06060606060600|c6c6c6d6feeec600|c6c6e6f6decec600|3c66666666663c00|06063e6666663e00|603c766666663c00|66361e3e66663e00|3c66603c06663c00|18181818185a7e00|7c66666666666600|183c666666666600|c6eefed6c6c6c600|c6c66c386cc6c600|1818183c66666600|7e060c1830607e00|
                            0000000000000000|7c667c603c000000|3e66663e06060600|3c6606663c000000|7c66667c60606000|3c067e663c000000|0c0c3e0c0c6c3800|3c607c66667c0000|6666663e06060600|3c18181800180000|1c36363030003000|66361e3666060600|1818181818181800|d6d6feeec6000000|6666667e3e000000|3c6666663c000000|06063e66663e0000|f0b03c36363c0000|060666663e000000|3e403c027c000000|1818187e18180000|7c66666666000000|183c666600000000|7cd6d6d6c6000000|663c183c66000000|3c607c6666000000|3c0c18303c000000">
                        Letters
                    </a>
                </li>
                <li>Set №2:
                    <a href="#1c08080808080c08|3e0408102020221c|1c2220201820221c|20203e2224283020|1c2220201e02023e|1c2222221e02221c|040404081020203e|1c2222221c22221c|1c22203c2222221c|1c2222222222221c">
                        Digits
                    </a> /
                    <a href="#5554545050404000|3f21212121212121|3f212d2121212121|3f212d212d212121|3f212d212d212d21|3f212d2d2d212121|3f212d2d2d2d2d2d|00040a1120408000|081c3e7f1c1c1c1c|0010307fff7f3010|1c1c1c1c7f3e1c08|00080cfefffe0c08">
                        Icons
                    </a>
                </li>
                <li>Set №3:
                    <a href="#0000000000000000|0000000000000000|0000000000000000|0001000000000000|0003000000000000|0007010000000000|00010f0300000000|01031f0701000000|02063f0e02010000|02040d7f1c040200|04081bff38080400|081036fe70100800|10206cfce0201000|0010206cfce02010|002040d8f8c04020|00002040d8f8c040|0000004080b0f080|000000800060e000|000000000000c0c0|0000000000000080|0000000000000000">
                        Plane
                    </a>
                </li>
            </ul>
        </div>
        <div class="col-xs-6 col-md-3 col-md-push-6 debug">
            <div class="checkbox pull-right" style="margin-top: 25px;">
                <label> <input type="checkbox" id="images-as-byte-arrays"> As byte arrays </label>
            </div>

            <h3>Arduino/C code</h3>

            <textarea id="output" spellcheck="false" style="width: 100%;"></textarea>

        </div>

        <div id="circuit" class="col-xs-12 col-md-6 col-md-pull-3 text-center debug">
            <table style="display: inline-block;">
                <tr>
                    <td>
                        <table id="matrix">
                            <tr>
                                <td id="matrix-toggle" title="Select/Clear all elements">
                                    <span class="glyphicon glyphicon-th-large"></span>
                                </td>
                                <td>
                                    <div id="cols-container"></div>
                                </td>
                                <td style="width: 15px;"></td>
                            </tr>
                            <tr>
                                <td id="rows-container"></td>
                                <td id="leds-container"></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td></td>
                                <td style="height: 15px;"></td>
                            </tr>
                        </table>
                    </td>
                    <td>
                        <div id="player">
                            <label for="play-delay-input" style="padding-right: 10px;">Play </label>
                            <input id="play-delay-input" type="number" min="10" value="500">
                            <small id="ms"> ms.</small>
                            <button id="play-button">
                                <span id="play-button-play" class="glyphicon glyphicon-play"></span>
                                <span id="play-button-stop" style="display: none" class="glyphicon glyphicon-stop"></span>
                            </button>
                        </div>
                        <div style="height: 25px;"></div>
                        <div id="shift-buttons-container">
                            <button id="shift-up-button" style="top:10px; left:50px;" title="Shift matrix up">
                                <span class="glyphicon glyphicon-chevron-up"></span>
                            </button>
                            <button id="shift-right-button" style="top:50px; left:90px;" title="Shift matrix right">
                                <span class="glyphicon glyphicon-chevron-right"></span>
                            </button>
                            <button id="shift-down-button" style="top:90px; left:50px;" title="Shift matrix down">
                                <span class="glyphicon glyphicon-chevron-down"></span>
                            </button>
                            <button id="shift-left-button" style="top:50px; left:10px;" title="Shift matrix left">
                                <span class="glyphicon glyphicon-chevron-left"></span>
                            </button>
                            <button id="rotate-button" style="top: 50px; left: 50px;" title="Rotate matrix">
                                <span class="glyphicon glyphicon-retweet"></span>
                            </button>
                        </div>
                        <div style="height: 25px;"></div>
                    </td>
                </tr>

                <tr>
                    <td colspan="2">
                        <div id="edit-buttons-container">
                            <button id="import-button" title="Import matrixs into the animation">Import</button>
                            <button id="insert-button" title="Insert matrix into the animation">Insert</button>
                            <button id="update-button" title="Update matrix in the animation">Update</button>
                            <button id="delete-button" title="Delete matrix from the animation">Delete</button>

                            <label for="hex-input" style="padding: 0 10px 0 25px;">HEX </label>
                            <input id="hex-input" maxlength="16" spellcheck="false" placeholder="UINT64 HEX" title="Input matrix as a 64-bit number in HEX format">
                        </div>
                    </td>
                </tr>
            </table>
        </div>

    </div>


    <div class="row" style="padding: 5px;">
        <small>
            Use Drag-and-Drop to reorder matrices
            <span class="glyphicon glyphicon-hand-down"></span>
        </small>
    </div>

    <div id="frames" class="row" style="clear: both; "></div>
</div>

<div class="container">
    <h3>Additional Function</h3>
    <ul>
        <li>Draw/Erase items by draging on matrix items</li>
        <li>Toggle items by clicking matrix items/row number/column number/<span class="glyphicon glyphicon-th-large"></span> icon with shift key</li>
        <li>Shift the matrix using arrow keys</li>
        <li>Cyclically shift the matrix using arrow keys with shift key</li>
        <li>Rotate the matrix clockwise or counterclockwise using ctrl+left/ctrl+right</li>
        <li>Flip the matrix vertically using ctrl+up/ctrl+down</li>
        <li>Copy and Paste the matrix using ctrl+C and ctrl+V</li>
        <li>Paste the matrix with xor mode using ctrl+shift+V</li>
        <li>Undo the action on LED matrix using ctrl+Z</li>
        <li>Insert images using enter key; Update images using ctrl+enter; Delete images using delete key</li>
        <li>Focus others images using pageup/pagedown</li>
        <li>Reorder images using alt+pageup/alt+pagedown</li>
        <li>Play/Stop animation using space key</li>
        <li>Import images using import button</li>
    </ul>

</div>

</body>

</html>
